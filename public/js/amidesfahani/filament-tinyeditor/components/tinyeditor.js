var m=(E,g,w={})=>{E.getContainer().closest("form")?.dispatchEvent(new CustomEvent(g,{composed:!0,cancelable:!0,detail:w}))};function ft({activePanel:E,state:g,statePath:w,selector:F,plugins:U,external_plugins:C,toolbar:A,text_patterns:M,language:$="en",language_url:I=null,directionality:O="ltr",height:T=null,max_height:x=0,min_height:z=100,width:S=null,max_width:_=0,min_width:k=400,resize:P=!1,skin:L="oxide",content_css:D="default",toolbar_sticky:B=!0,toolbar_sticky_offset:et=64,toolbar_mode:it="sliding",toolbar_location:ot="auto",inline:nt=!1,toolbar_persist:st=!1,menubar:R=!1,font_size_formats:V="",fontfamily:K="",relative_urls:W=!0,image_list:q=null,image_advtab:G=!1,image_description:j=!1,image_class_list:H=null,images_upload_url:N=null,images_upload_base_path:J=null,remove_script_host:Q=!0,convert_urls:X=!0,custom_configs:Y={},setup:v=null,disabled:rt=!1,locale:at="en",license_key:Z="gpl",placeholder:lt=null,removeImagesEventCallback:f=null,uploadingMessage:dt="Uploading image...",key:d}){let u=window.filamentTinyEditors||{};return{activePanel:E,id:null,state:g,statePath:w,selector:F,language:$,language_url:I,directionality:O,height:T,max_height:x,min_height:z,width:S,max_width:_,min_width:k,resize:P,skin:L,content_css:D,plugins:U,external_plugins:C,toolbar:A,text_patterns:M,toolbar_sticky:B,menubar:R,relative_urls:W,remove_script_host:Q,convert_urls:X,font_size_formats:V,fontfamily:K,setup:v,image_list:q,image_advtab:G,image_description:j,image_class_list:H,images_upload_url:N,images_upload_base_path:J,license_key:Z,custom_configs:Y,updatedAt:Date.now(),disabled:rt,locale:at,placeholder:lt,removeImagesEventCallback:f,isUploadingFile:!1,isModalOpen:!1,init(){this.delete(),this.tryInitializeEditor(g.initialValue),window.filamentTinyEditors=u,this.$watch("state",(t,s)=>{t==="<p></p>"&&t!==this.editor()?.getContent()&&(this.editor()&&this.editor().destroy(),this.initEditor(t)),this.editor()?.container&&t!==this.editor()?.getContent()&&(this.updateEditorContent(t||""),this.putCursorToEnd())}),window.addEventListener("rich-editor-uploading-file",t=>{t.detail.livewireId===this.$wire.id&&t.detail.key===d&&(this.isUploadingFile=!0,t.stopPropagation())}),window.addEventListener("rich-editor-uploaded-file",t=>{t.detail.livewireId===this.$wire.id&&t.detail.key===d&&(this.isUploadingFile=!1,t.stopPropagation())}),this.$el.closest(".fi-modal")?.addEventListener("open-modal",()=>{this.isModalOpen=!0,this.$nextTick(()=>this.tryInitializeEditor(this.state||""))}),this.$el.closest(".fi-modal")?.addEventListener("close-modal",()=>{this.isModalOpen=!1,this.delete()}),window.addEventListener("livewire:navigated",()=>{this.isModalOpen&&this.$nextTick(()=>this.tryInitializeEditor(this.state||""))})},editor(){return tinymce.get(u[this.statePath])},tryInitializeEditor(t){if(!document.querySelector(this.selector)){console.warn(`TinyMCE target node ${this.selector} not found. Retrying...`),setTimeout(()=>this.tryInitializeEditor(t),100);return}this.initEditor(t)},getFileAttachmentUrl:t=>this.$wire.callSchemaComponentMethod(d,"getUploadedFileAttachmentTemporaryUrl",{attachment:t}),initEditor(t){let s=this,tt=K||"Arial=arial,helvetica,sans-serif; Courier New=courier new,courier,monospace; AkrutiKndPadmini=Akpdmi-n",ct={selector:F,language:$,language_url:I,directionality:O,statusbar:!1,promotion:!1,height:T,max_height:x,min_height:z,width:S,max_width:_,min_width:k,resize:P,skin:L,content_css:D,plugins:U,external_plugins:C,toolbar:A,text_patterns:M,toolbar_sticky:B,toolbar_sticky_offset:et,toolbar_mode:it,toolbar_location:ot,inline:nt,toolbar_persist:st,menubar:R,menu:{file:{title:"File",items:"newdocument restoredraft | preview | export print | deleteallconversations"},edit:{title:"Edit",items:"undo redo | cut copy paste pastetext | selectall | searchreplace"},view:{title:"View",items:"code | visualaid visualchars visualblocks | spellchecker | preview fullscreen | showcomments"},insert:{title:"Insert",items:"image link media addcomment pageembed codesample inserttable | charmap emoticons hr | pagebreak nonbreaking anchor tableofcontents | insertdatetime"},format:{title:"Format",items:"bold italic underline strikethrough superscript subscript codeformat | styles blocks fontfamily fontsize align lineheight | forecolor backcolor | language | removeformat"},tools:{title:"Tools",items:"spellchecker spellcheckerlanguage | a11ycheck code wordcount"},table:{title:"Table",items:"inserttable | cell row column | advtablesort | tableprops deletetable"},help:{title:"Help",items:"help"}},font_size_formats:V||"8pt 10pt 12pt 14pt 16pt 18pt 24pt 36pt 48pt",fontfamily:tt,font_family_formats:tt,relative_urls:W,remove_script_host:Q,convert_urls:X,image_list:q,image_advtab:G,image_description:j,image_class_list:H,images_upload_url:N,images_upload_base_path:J,license_key:Z,...Y,setup:function(e){window.tinySettingsCopy||(window.tinySettingsCopy=[]),e.settings&&!window.tinySettingsCopy.some(n=>n.id===e.settings.id)&&window.tinySettingsCopy.push(e.settings),e.on("blur",function(n){s.updatedAt=Date.now(),s.state=e.getContent(),s.$wire.callSchemaComponentMethod(d,"cleanUpUnusedImages",{state:s.state})}),e.on("change",function(n){s.updatedAt=Date.now(),s.state=e.getContent(),s.$wire.callSchemaComponentMethod(d,"cleanUpUnusedImages",{state:s.state})}),e.on("init",function(n){u[s.statePath]=e.id,t!=null&&e.setContent(t)}),e.on("OpenWindow",function(n){let a=n.target.container.closest(".fi-modal");a&&a.setAttribute("x-trap.noscroll","false")}),e.on("CloseWindow",function(n){let a=n.target.container.closest(".fi-modal");a&&a.setAttribute("x-trap.noscroll","isOpen")}),typeof v=="function"&&v(e)},removeImagesEventCallback:e=>{this.$wire.callSchemaComponentMethod(d,"deleteUploadedImage",{src:e})},images_upload_handler:(e,n)=>new Promise((a,h)=>{if(!e.blob()){h("No file provided");return}this.isUploadingFile=!0,m(this.editor(),"form-processing-started",{message:dt});let p=("10000000-1000-4000-8000"+-1e11).replace(/[018]/g,i=>(i^crypto.getRandomValues(new Uint8Array(1))[0]&15>>i/4).toString(16));this.editor().getContainer().dispatchEvent(new CustomEvent("rich-editor-uploading-file",{bubbles:!0,detail:{key:d,livewireId:this.$wire.id}})),this.$wire.upload(`componentFileAttachments.${w}.${p}`,e.blob(),()=>{this.getFileAttachmentUrl(p).then(i=>{if(!i){h("Image upload failed - no URL returned"),this.isUploadingFile=!1,m(this.editor(),"form-processing-finished");return}this.editor().getContainer().dispatchEvent(new CustomEvent("rich-editor-uploaded-file",{bubbles:!0,detail:{key:d,livewireId:this.$wire.id}})),m(this.editor(),"form-processing-finished"),this.isUploadingFile=!1,a(i);let r=this.editor();r.once("SetContent",({content:y,format:c,paster:o,selection:b})=>{let l=r.getBody().querySelectorAll("img:not([data-id])");l.length>0&&l[l.length-1].setAttribute("data-id",p)})}).catch(i=>{console.error("Upload error:",i),h(i),this.isUploadingFile=!1,m(this.editor(),"form-processing-finished")})},i=>{h("Upload failed: "+i),this.isUploadingFile=!1,m(this.editor(),"form-processing-finished")},i=>{n(i.detail.progress*100)})}),init_instance_callback:function(e){var n=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,a=f&&typeof f=="function";if(a){var h=new n(function(p,i){var r=[];p.forEach(function(c){Array.from(c.addedNodes).forEach(function(o){if(o.nodeName==="IMG"&&o.className!=="mce-clonedresizable"){if(r.indexOf(o.src)>=0)return;r.push(o.getAttribute("src"));return}var b=o.getElementsByTagName("img");Array.from(b).forEach(function(l){r.indexOf(l.src)>=0||r.push(l.getAttribute("src"))})})});var y=[];p.forEach(function(c){Array.from(c.removedNodes).forEach(function(o){if(o.nodeName==="IMG"&&o.className!=="mce-clonedresizable"){if(y.indexOf(o.src)>=0)return;y.push(o.getAttribute("src"));return}if(o.nodeType===1){var b=o.getElementsByTagName("img");Array.from(b).forEach(function(l){r.indexOf(l.src)>=0||r.push(l.getAttribute("src"))})}})}),y.forEach(function(c){r.indexOf(c)>=0||f&&typeof f=="function"&&f(c)})});h.observe(e.getBody(),{childList:!0,subtree:!0})}},automatic_uploads:!0};tinymce.init(ct)},updateEditorContent(t){this.editor().setContent(t)},putCursorToEnd(){this.editor().selection.select(this.editor().getBody(),!0),this.editor().selection.collapse(!1)},delete(){try{u[this.statePath]&&(this.editor().destroy(),delete u[this.statePath])}catch{console.log(u[this.statePath]),console.log(this.editor())}}}}export{ft as default};
